<!DOCTYPE html>

<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/"
  data-template="vertical-menu-template-free">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <style>
    td:hover {
      cursor: pointer;
      background-color: #ccc;
    }
  </style>
  <title>KSPCLA</title>

  <meta name="description" content="" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon"  href="../images/logo.jpg" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.2/css/jquery.dataTables.css">

  <script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.js"></script>
  <!-- Icons. Uncomment required icon fonts -->
  <link rel="stylesheet" href="../assets/boxicons/boxicons.css" />
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">

  <!-- Core CSS -->
  <link rel="stylesheet" href="../css/sneatbs/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="../css/sneatbs/theme-default.css" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="../css/sneatbs/demo.css" />
  <link type="text/css"
    href="https://gyrocode.github.io/jquery-datatables-checkboxes/1.2.12/css/dataTables.checkboxes.css"
    rel="stylesheet" />
  <script type="text/javascript"
    src="https://gyrocode.github.io/jquery-datatables-checkboxes/1.2.12/js/dataTables.checkboxes.min.js"></script>

  <!-- Vendors CSS -->

  <!-- Page CSS -->

  <!-- Helpers -->
  <script src="../js/sneatjs/helpers.js"></script>

  <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
  <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
  <script src="../js/sneatjs/config.js"></script>
  <style>
    td:hover {
      cursor: pointer;
      background-color: #ccc;
    }

    .cards {
      display: flex;
      flex-direction: column;
    }

    .cards .d-flex {
      flex-wrap: wrap-reverse;
    }

    .cards .d-flex>* {
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .cards .d-flex>*:last-child {
      margin-right: 0;
    }

    .button {

      /* background-color:  rgba(128, 128, 128, 0.932); */
      /* border: 2px solid  #a5a391; */
      border: 2px solid rgb(0 0 200/0.6);
      background-color: rgba(0 0 200/0.6);
      color: rgb(255 255 255 / 1);
      box-shadow: 1px 1px 2px rgb(0 0 200 / 0.4);
      /* border-radius: 10px; */
      padding: 3px 10px;
      display: inline-block;
      cursor: pointer;
      margin-left: 4px;

    }

    div #pagination-buttons {
      display: flex;
      justify-content: center;

    }

    .active {
      background-color: orange;
    }

    @media only screen and (min-width:1200px) {
      .logout {
        display: none;
      }
    }
    center .register{
      color:#25266D;
    }
  </style>

</head>

<body>
  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <!-- Menu -->

      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme" style="background-color:#ECECEC">
        <div class="app-brand demo">
          <a href="#" class="app-brand-link">
            <span class="app-brand-text demo menu-text fw-bolder ms-2">Dashboard</span>
          </a>

          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
            <i class="bx bx-chevron-left bx-sm align-middle"></i>
          </a>
        </div>

        <div class="menu-inner-shadow"></div>

        <ul class="menu-inner py-1">
          <!-- Dashboard -->
          <li class="menu-item">
            <a href="dashboard.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-home-circle"></i>
              <div data-i18n="Analytics">Dashboard</div>
            </a>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-dock-top"></i>
              <div data-i18n="Account Settings">Account Settings</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a class="menu-link" href="auth-login-basic.html">
                  <div data-i18n="Basic">Log Out</div>
                </a>
              </li>
            </ul>
          </li>

        </ul>
      </aside>
      <!-- / Menu -->

      <!-- Layout container -->
      <div class="layout-page">
        <!-- Navbar -->



        <!-- / Navbar -->

        <!-- Content wrapper -->
        <div class="content-wrapper">
          <!-- Content -->

          <div class="container-xxl flex-grow-1 container-p-y">
            <a class="" href="auth-login-basic.html">
              <button class="btn btn-warning logout " style="float: right" href="auth-login-basic.html">Log Out
              </button>
            </a>
            <center >
              <h4 class="fw-bold py-3 mb-4 register"><span class=" fw-light">Registered</span> Members </h4>
            </center>


            <!-- Basic Bootstrap Table -->
            <div  style="display:flex; justify-content: space-between; align-items: center;">
              <div class="form-check form-control" style="display: inline-block;background-color:#ECECEC">
                <h5 class="card-header">
                  <input class="form-check-input" type="checkbox" value="" id="defaultCheck3" unchecked=""
                    onclick="javascript:checkAll(this)" style="margin-top:8px;border-color: #3B55A4">
                  <label class="form-check-label" for="defaultCheck3" style="margin-top:6px;color: #3B55A4">
                    Select All
                  </label>
            
                  <button type="button" class="btn btn-danger" id="deleteData" onClick="deleteRow()">Delete Data</button>
            
                  <button type="button" id="get_data" class="btn btn-success" style="float: right;margin-left:10px;">Go</button>
         
            <select  id="employeeHomedistrict" name="clg_city" style="color: #25266D; font-size: 15px; font-weight: 500;float: right;margin-left:10px;border-color: #3B55A4;width: 10%;height: 38px;border-radius: 5px;background-color: #ECECEC;" class="form-control" placeholder=" " >
              <option >District</option>
          <option value="Bagalkot">Bagalkot</option>
          <option value="Bangalore Rural">Bangalore Rural</option>
          <option value="Bangalore Urban">Bangalore Urban</option>
          <option value="Belgaum">Belgaum</option>
          <option value="Bellary">Bellary</option>
          <option value="Bidar">Bidar</option>
          <option value="Bijapur">Bijapur</option>
          <option value="Chamarajanagar">Chamarajanagar</option>
          <option value="Chikkaballapur">Chikkaballapur</option>
          <option value="Chikmagalur">Chikmagalur</option>
          <option value="Chitradurga">Chitradurga</option>
          <option value="Dakshina Kannada">Dakshina Kannada</option>
          <option value="Davanagere">Davanagere</option>
          <option value="Dharwad">Dharwad</option>
          <option value="Gadag">Gadag</option>
          <option value="Gulbarga">Gulbarga</option>
          <option value="Hassan">Hassan</option>
          <option value="Haveri">Haveri</option>
          <option value="Kodagu">Kodagu</option>
          <option value="Kolar">Kolar</option>
          <option value="Koppal">Koppal</option>
          <option value="Mandya">Mandya</option>
          <option value="Mysore">Mysore</option>
          <option value="Raichur">Raichur</option>
          <option value="Ramanagara">Ramanagara</option>
          <option value="Shimoga">Shimoga</option>
          <option value="Tumkur">Tumkur</option>
          <option value="Udupi">Udupi</option>
          <option value="Uttara Kannada">Uttara Kannada</option>
          <option value="Yadgir">Yadgir</option>
  
        </select>
  
  
                  <select name="per_page" id="data" style="float: right;border-color: #3B55A4;width: 6%;height: 38px;border-radius: 5px;background-color: #ECECEC;">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                  </select>
                </h5>
              </div>
            </div>
            
            <div class="table-responsive text-nowrap">
              <table class="table" id="employees">
                <thead>
                  <tr id="row-1">
                    <th rowspan="2">action</th>
                    <th rowspan="2">sl.</th>
                    <th rowspan="2">Full Name</th>
                    <th rowspan="2"> Subject</th>
                    <th rowspan="2">Eigibility</th>
                    <th colspan="6">College Address/Code</th>
                    <th colspan="7">Employee Contact Details</th>
                    <th rowspan="2">issue date</th>
                    <th rowspan="2">join date</th>
                    <th rowspan="2">fees</th>
                    <th rowspan="2">paid date</th>
                    <th rowspan="2">receipt</th>
                    <th rowspan="2">blood grup</th>
                  </tr>
                  <tr id="row-2">
                    <th>Street Name</th>
                    <th> state</th>
                    <th> city</th>
                    <th> Country</th>
                    <th> Zip Code</th>
                    <th> Code </th>
                    <th> Street Name</th>
                    <th> State</th>
                    <th> City</th>
                    <th> Country</th>
                    <th> Zip Code</th>
                    <th> Contact</th>
                    <th> Alternate Contact</th>
                  </tr>
                </thead>
                <tbody class="table-border-bottom-0">
                  <tr id="row-3">
                  </tr>
                </tbody>

              </table>
              <div id="pagination-buttons">
              </div>

              <div class='pagination-container'>
                <nav>
                  <ul class="pagination">

                    <li data-page="prev">
                      <span> <span class="sr-only">(current)</span></span>
                    </li>
                    <!--	Here the JS Function Will Add the Rows -->
                    <li data-page="next" id="prev">
                      <span> <span class="sr-only">(current)</span></span>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>

          <script src="../js/mdbjs/server_conf.js"></script>

          <script>
            tableEle = document.getElementById('employees');
            let cnt = 0;
            function row(user) {
              const empId = user['emp_contact'];
              trEle = document.createElement('tr');
              trEle.classList.add('user')
              tdEle = document.createElement('td');
              var checkbox = document.createElement("INPUT"); //Added for checkbox
              checkbox.type = "checkbox"; //Added for checkbox
              checkbox.id = empId;
              var editIcon = document.createElement('i');
              editIcon.classList.add('fa-solid', 'fa-pen-to-square', 'editbtn');
              editIcon.id = empId;
              tdEle.append(checkbox); //Added for checkbox
              tdEle.append(editIcon); //Added for edit icon

              trEle.appendChild(tdEle);
              tdEle = document.createElement('td');
              cnt += 1;
              aEle = document.createElement('a');
              aEle.href = `${serverAddress}/templates/login.html?id=` + empId;
              aEle.textContent = cnt;
              tdEle.appendChild(aEle);
              trEle.appendChild(tdEle);
              for (let detail of Object.keys(user)) {
                if (detail == 'img_name'){
                  continue
                } // after the demo do this in python.
                tdEle = document.createElement('td');
                tdEle.textContent = user[detail];
                tdEle.classList.add('editable');
                trEle.appendChild(tdEle);
              };
              tableEle.appendChild(trEle);
            }
            function appendData(data) {
              // console.log(data)
              for (let i = 0; i < data.length - 1; i++) {
                row(data[i])
              };
              createEditBtns()
            }
            function createEditBtns() {
              let editableCells = ''; // for editing the specified row cells
              let editButtons = document.querySelectorAll('.editbtn'); // for edit icons
              function edit(editableCells) {
                editableCells.forEach(cell => {
                  cell.addEventListener('click', () => {
                    let input = document.createElement('input');
                    input.type = 'text';
                    input.value = cell.innerText;
                    input.addEventListener('blur', () => {
                      cell.innerText = input.value;
                    });
                    cell.innerText = input.value;
                    cell.appendChild(input); // here the new value getting stored
                    input.focus(); // function exit by lossing it's focus
                  });
                });
              }
              async function postReq(req, empCon) {
                const url = 'http://13.234.186.61:5000/admin/dashboard/' + empCon;
                let data = req;
                // PUT request using fetch with async/await
                console.log('before:', typeof (data));
                const requestOptions = {
                  method: 'PUT',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(data)
                };
                console.log('after:', typeof (requestOptions['body']));
                const response = await fetch(url, requestOptions);
                const result = await response.json();
                console.log(result);
                // location.reload();
              }
              editButtons.forEach(i => {
                i.addEventListener('click', (event) => {
                  console.log('clicked')
                  let empId = event.target.id;
                  let rows = document.querySelectorAll('.user');
                  rows.forEach(row => {
                    let rowEmpId = row.firstChild.lastChild.id;
                    if (rowEmpId === empId) {
                      if (row.firstChild.childNodes[1].classList.value.includes('text-success')) {
                        row.firstChild.childNodes[1].classList.remove(['text-success']);
                        const data = {
                          full_name: row.childNodes[2].textContent,
                          content_subject: row.childNodes[3].textContent,
                          eligibility: row.childNodes[4].textContent,
                          clg_street_name: row.childNodes[5].textContent,
                          clg_state: row.childNodes[6].textContent,
                          clg_city: row.childNodes[7].textContent,
                          clg_contry: row.childNodes[8].textContent,
                          clg_zip_code: row.childNodes[9].textContent,
                          clg_code: row.childNodes[10].textContent,
                          emp_street_name: row.childNodes[11].textContent,
                          emp_state: row.childNodes[12].textContent,
                          emp_city: row.childNodes[13].textContent,
                          emp_contry: row.childNodes[14].textContent,
                          emp_zip_code: row.childNodes[15].textContent,
                          emp_alt_contact: row.childNodes[17].textContent,
                          issue_date: row.childNodes[18].textContent,
                          joining_date: row.childNodes[19].textContent,
                          fee: row.childNodes[20].textContent,
                          transact_date: row.childNodes[21].textContent,
                          reciept_num: row.childNodes[22].textContent,
                          blood_grp: row.childNodes[23].textContent,
                        }
                        console.log(data);
                        postReq(data, row.childNodes[16].textContent);
                        return;
                      }
                      row.firstChild.childNodes[1].classList.add('text-success');
                      console.log(row.firstChild.childNodes[1]);
                      let cells = row.querySelectorAll('.editable');
                      console.log(cells)
                      cells.forEach(cell => {
                        edit(cells)
                      });
                    }
                  });
                });
              });
            };


          </script>
          <script>
            function removeActive() {  // surya
              let activeEle = document.querySelectorAll('.active');
              // console.log('here : ',activeEle)
              if (activeEle.length > 0) {
                activeEle[0].classList.remove(['active']);
              }
            }

            fetch('http://13.234.186.61:5000/admin/teachers')
              .then(x => x.json())
              .then(y => {
                data = y;
                //Dynamic creation of buttons
                let numberOfRecords = data[data.length - 1].number_of_teachers;
                let per_page = parseInt(document.querySelector('#data').value)
                let numberOfDynamicbuttons = Math.ceil(numberOfRecords / per_page)

                // original 
                for (let i = 1; i <= numberOfDynamicbuttons; i++) {
                  let paginationButtons = document.querySelector('#pagination-buttons');
                  let myButton = document.createElement('button');
                  if (i == 1) {
                    myButton.setAttribute('class', 'button active')
                  } else {
                    myButton.setAttribute('class', 'button')
                  }

                  myButton.textContent = i;
                  paginationButtons.appendChild(myButton);
                }
                appendData(y);
                // Create buttons
                // Get all the buttons

                // Get all the buttons







                //Adding event listeners to button to get the particualar page  
                let number_of_buttons = document.querySelectorAll('.button').length;
                for (let i = 0; i < number_of_buttons; i++) {
                  document.querySelectorAll('.button')[i].addEventListener('click', function (event) {
                    let tableRowLength = document.querySelector('.table').rows.length;
                    let page = event.target.innerText;
                    removeActive() // surya
                    document.getElementById("defaultCheck3").checked = false; // surya
                    event.target.classList.add(['active']); // surya
                    // console.log(event.target)

                    cnt = 0;
                    while (tableRowLength > 1) {
                      document.querySelector('.table').deleteRow(1);
                      tableRowLength -= 1;
                    }
                    let perPage = document.querySelector('#data').value;

                    fetch(`http://13.234.186.61:5000/admin/teachers?page=${page}&per_page=${perPage}`)
                      .then(x => x.json())
                      .then(y => appendData(y))
                  })
                }

              })

            //Script that will be executed after clicking on GO in pagination 
            document.querySelector('#get_data').addEventListener('click', function () {
              let tableRowLength = document.querySelector('.table').rows.length;
              cnt = 0;
              while (tableRowLength > 1) {
                document.querySelector('.table').deleteRow(1);
                tableRowLength -= 1;
              }

              //Removing all the pagination buttons
              // get all elements with the specified class
              const buttonsToRemove = document.querySelectorAll('.button');

              // loop through the elements and remove each one
              buttonsToRemove.forEach(button => {
                button.remove();
              });

              let perPage = parseInt(document.querySelector('#data').value)
              fetch(`http://13.234.186.61:5000/admin/teachers?page=1&per_page=${perPage}`)
                .then(x => x.json())
                .then(y => {
                  data = y;
                  //Dynamic creation of buttons
                  let numberOfRecords = data[data.length - 1].number_of_teachers;
                  let per_page = parseInt(document.querySelector('#data').value)
                  let numberOfDynamicbuttons = Math.ceil(numberOfRecords / per_page)
                  for (let i = 1; i <= numberOfDynamicbuttons; i++) {
                    let paginationButtons = document.querySelector('#pagination-buttons');

                    let myButton = document.createElement('button');
                    if (i == 1) {
                      myButton.setAttribute('class', 'button active')
                    } else {
                      myButton.setAttribute('class', 'button')
                    }

                    myButton.textContent = i;
                    paginationButtons.appendChild(myButton);
                  }
                  appendData(y);
                  //Adding event listeners to button to get the particualar page  
                  let number_of_buttons = document.querySelectorAll('.button').length;
                  for (let i = 0; i < number_of_buttons; i++) {

                    document.querySelectorAll('.button')[i].addEventListener('click', function (event) {
                      let tableRowLength = document.querySelector('.table').rows.length;
                      let page = event.target.innerText
                      removeActive() // surya
                      document.getElementById("defaultCheck3").checked = false; // surya
                      event.target.classList.add(['active']); // surya

                      cnt = 0;
                      while (tableRowLength > 1) {
                        document.querySelector('.table').deleteRow(1);
                        tableRowLength -= 1;
                      }
                      let perPage = document.querySelector('#data').value;

                      fetch(`http://13.234.186.61:5000/admin/teachers?page=${page}&per_page=${perPage}`)
                        .then(x => x.json())
                        .then(y => appendData(y))
                    })
                  }

                })


            }
            )
          </script>
          <script>
            let header = document.getElementById("pagination-buttons");
            let btns = header.getElementsByClassName("button");
            for (var i = 0; i < btns.length; i++) {
              btns[i].addEventListener("click", function () {
                let current = document.getElementsByClassName("active");
                current[0].className = current[0].className.replace(" active", "");
                this.className += " active";
              });
            }


          </script>



          <!--/ Basic Bootstrap Table -->
          <script>
            function checkAll(o) {
              var boxes = document.getElementsByTagName("input");
              for (var x = 0; x < boxes.length; x++) {
                var obj = boxes[x];
                if (obj.type == "checkbox") {
                  if (obj.name != "check")
                    obj.checked = o.checked;
                }
              }
            }
          </script>
          <script>
            function delData(empPh) {
              const url = 'http://13.234.186.61:5000/admin/dashboard/' + empPh;
              (async () => {
                const requestOptions = {
                  method: 'DELETE',
                };
                const response = await fetch(url, requestOptions);
                const result = await response.text();
                console.log(result);
              })();
            }
            const tableEle = document.getElementById("employees")
            async function deleteRow() {
              let checkboxs = tableEle.querySelectorAll("input[type='checkbox']:checked")
              await checkboxs.forEach(checkbox => {
                delData(checkbox.id);
                checkbox.parentElement.parentElement.remove();
              });
              console.log('done');




            }
          </script>
          <hr class="my-5" />
          <div class="content-backdrop fade"></div>
        </div>
      </div>
    </div>
    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
  </div>
  <!-- / Layout wrapper -->

  <!-- for pagination  -->


  <!-- Pagination -->

  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="../js/sneatjs/jquery.js"></script>
  <script src="../js/sneatjs/popper.js"></script>
  <script src="../js/sneatjs/bootstrap.js"></script>
  <script src="../js/sneatjs/menu.js"></script>
  <!-- endbuild -->

  <!-- Vendors JS -->

  <!-- Main JS -->
  <script src="../js/sneatjs/main.js"></script>
  <!-- Page JS -->


</body>

</html>